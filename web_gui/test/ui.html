<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Home Temperature</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<style type="text/css">
   	body { padding-top: 70px; }
	</style>

	<!-- Font Awsome -->
	<link href="font-awesome/css/font-awesome.min.css" rel="stylesheet">
	
	<!-- Bootstrap -->
	<link href="bootstrap/css/bootstrap.css" rel="stylesheet">
	
	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
	   <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
	<![endif]-->
</head>
	<!--page content-->
<body>
	<div class='container'>
	
		<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		  <div class="container">
			<p class="navbar-brand">Daikin Control</p>
		  </div>
		</nav>
		
		<div  class="alert alert-danger sr-only" id="alert">
			<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
			<p></p>
		</div>
		
		<div class="container-fluid">
			<div class="row">
		  		
		  		<!-- ON/OFF -->
		  		<div class="col-sm-offset-10 col-sm-2">
		  			<i class="fa fa-power-off" id="power" style="font-size:1.6em;color:black;text-shadow: 0px 0px 2px red;"><b> OFF</b></i>
		  		</div>
	  		
	  		</div>
			<div class="row">
	   		<div class="col-sm-6">
	   		
	   			<!-- Mode -->
					<h4>Mode</h4>
					<div class="btn-group">
						<a class="btn btn-default mode-btn" id="mode_cooling"><i class="fa fa-asterisk fa-2x"></i></a>
						<a class="btn btn-default mode-btn" id="mode_dehum"><i class="fa fa-tint fa-2x"></i></a>
						<a class="btn btn-default mode-btn" id="mode_heating"><i class="fa fa-sun-o fa-2x"></i></a>
						<a class="btn btn-default mode-btn" id="mode_fan"><i class="fa fa-retweet fa-2x"></i></a>
						<a class="btn btn-default mode-btn" id="mode_auto"><i class="fa fa-font fa-2x"></i></a>
					</div>
					
		  		</div>
		  		<div class="col-sm-6">
		  		
		  			<!-- Fan -->
					<h4>Fan</h4>
					<div class="btn-group">
						<a class="btn btn-default fan-btn" id="fan_auto"><i class="fa fa-font fa-2x"></i></a>
						<a class="btn btn-default fan-btn" id="fan_eco"><i class="fa fa-leaf fa-2x"></i></a>
						<a class="btn btn-default fan-btn" id="fan_lvl"><img src="media/level_0.png" height="29px" id="fan_lvl_img"></a>
					</div>
		  			
		  		</div>
		  	</div>
		  	<br>
		  	<div class="row">
		  		<div class="col-sm-6">
		  			
		  			<!--Target temperature-->
					<h4>Target temperature</h4>
					<div class="btn-group" >
						<a class="btn btn-default" style="font-size:1.8em;"><b id="target_temp"> - C</b></a>
					</div>
		  			
		  		</div>
		  		<div class="col-sm-6">
		  			
		  			<!-- TEMPERATURES -->
					<h4>Temperatures</h4>
					<div class="btn-group" >
						<a class="btn btn-default" style="font-size:1.8em;">
							<i class="fa fa-home"></i><b id="home_temp"> - C</b>
						</a>
						<a class="btn btn-default" style="font-size:1.8em;">
							<i class="fa fa-image"></i><b id="outside_temp"> - C</b>
						</a>
					</div>
		  			
		  		</div>
	  		</div>
		</div>
	
	</div>
	<br>

	
	<script type="text/javascript">
   		
   		function timedRefresh(timeoutPeriod) {
				setTimeout("location.reload(true);",timeoutPeriod);
			}
			
			function request_control() {
				xmlhttp=new XMLHttpRequest();
				xmlhttp.onreadystatechange  = function () {
					if ( xmlhttp.readyState == 4 ){
						if( xmlhttp.status==200 ){
							var jsonObj = JSON.parse(xmlhttp.responseText);
							control_response_handler(jsonObj);
						}else{
							console.log("Error: control ajax request failed");
							set_alert(1,"<b>Error:</b> control ajax request failed");
						}
					}else{
						//alert(xmlhttp.readyState);
					}
				}
				xmlhttp.open("POST","http://tommyael.tk/aircon/api.php",true);
				xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
				xmlhttp.send("uri=/aircon/get_control_info");
			}
			
			function request_sensor(){
				xmlhttp=new XMLHttpRequest();
				xmlhttp.onreadystatechange  = function () {
					if ( xmlhttp.readyState == 4 ){
						if( xmlhttp.status==200 ){
							var jsonObj = JSON.parse(xmlhttp.responseText);
							sensor_response_handler(jsonObj);
						}else{
							console.log("Error: sensor ajax request failed");
							set_alert(1,"<b>Error:</b> sensor ajax request failed");
						}
					}else{
						//alert(xmlhttp.readyState);
					}
				}
				xmlhttp.open("POST","http://tommyael.tk/aircon/api.php",true);
				xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
				xmlhttp.send("uri=/aircon/get_sensor_info");
			}
			
			function control_response_handler(jsonObj){
				reset_mode();
				reset_fan();
				set_power(parseInt(jsonObj.pow));
				set_mode(parseInt(jsonObj.mode));
			}
			
			function control_response_handler(jsonObj){
				set_home_temp(jsonObj.htemp);
				set_outside_temp(jsonObj.otemp);
			}
			
			
			function set_power(boolean){
				power = document.getElementById("power")
				if(boolean){
					power.firstElementChild.innerHTML = " ON";
					power.style.textShadow="0px 0px 2px green";
				}else{
					power.firstElementChild.innerHTML = " OFF";			
					power.style.textShadow="0px 0px 2px red";
				}
			}
			
			function reset_mode(){
				var mode_list= document.getElementsByClassName("mode-btn btn-info");
				
				for(var i=0; i<mode_list.length; ++i){
					mode_list[i].className="btn btn-default mode-btn";
				}
			}
			
			function set_mode(mode){
				//2 dehum
				//3 cooling
				//4 heating
				//6 fan
				//7 auto
				switch(mode){
					case 2:
						document.getElementById("mode_dehum").className="btn btn-info mode-btn";
						break;
					case 3:
						document.getElementById("mode_cooling").className="btn btn-info mode-btn";
						break;
					case 4:
						document.getElementById("mode_heating").className="btn btn-info mode-btn";
						break;
					case 6:
						document.getElementById("mode_fan").className="btn btn-info mode-btn";
						break;
					case 7:
						document.getElementById("mode_auto").className="btn btn-info mode-btn";
						break;
					default:
						console.log("set_mode() switch: default case reached");
				}
			}
			
			function set_home_temp(temp){
				document.getElementById("home_temp").innerHTML=" "+temp+" C";	
			}
			
			function set_outside_temp(temp){
				document.getElementById("outside_temp").innerHTML=" "+temp+" C";
			}
			
			function set_target_temp(temp){
				document.getElementById("target_temp").innerHTML=" "+temp+" C";	
			}
			
			function set_fan(f_mode){
				switch(f_mode){
					case 1:
						document.getElementById("fan_auto").className="btn btn-info fan-btn";
						break;
					case 2:
						document.getElementById("fan_eco").className="btn btn-info fan-btn";
						break;
					case 3:
						document.getElementById("fan_lvl_img").src="media/level_1.png";
						break;
					case 4:
						document.getElementById("fan_lvl_img").src="media/level_2.png";
						break;
					case 5:
						document.getElementById("fan_lvl_img").src="media/level_3.png";
						break;
					case 6:
						document.getElementById("fan_lvl_img").src="media/level_4.png";
						break;
					case 7:
						document.getElementById("fan_lvl_img").src="media/level_5.png";
						break;
					
					default:
						console.log("set_fan() switch: default case reached");
				}
			}
			
			function reset_fan(){
				var fan_list= document.getElementsByClassName("btn-info fan-btn");
				for(var i=0; i<fan_list.length; ++i){
					fan_list[i].className="btn btn-default fan-btn";
				}
				document.getElementById("fan_lvl_img").src="media/level_0.png";
			}
			
			function set_alert(boolean,mex){
				var alert = document.getElementById("alert");
				if(boolean){
					alert.classList.remove("sr-only")
					alert.className="alert alert-danger";
					alert.lastElementChild.innerHTML=mex;
					
				}else{
					alert.className="alert alert-danger sr-only";
					alert.classList.add("sr-only");
				
				}
			}
			request();
	</script>
	<!--
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="bootstrap/js/bootstrap.min.js"></script>
	-->
</body>
</html>
